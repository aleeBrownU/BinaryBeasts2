# -*- coding: utf-8 -*-
"""
Spyder Editor

This is a temporary script file.

"""

"""
import sys
import os
import time
import pandas as pd
import matplotlib as mlp
import matplotlib.pyplot as plt
import random
import numpy as np
from tkinter import Tk, Canvas, Label, Frame, Entry, Button, Text, BOTTOM, LEFT, TOP, RIGHT, END
from PIL import ImageTk, Image
from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg


window = Tk()
window.resizable(width=False, height=False)
#w, h = window.winfo_screenwidth(), window.winfo_screenheight()
window.geometry("%dx%d+0+0" % (1296, 782))
#topframe = Frame(window)
#topframe.pack()
#bottomframe = Frame(window)
#bottomframe.pack(side=BOTTOM)
# Add image file
bgimg = ImageTk.PhotoImage(Image.open("/Users/kushpatel/Downloads/wavebgrnd.png"))
#bglabel = Label(image=bhimg)
welcomemsg= """Hi! This is the Iowa Gambling Task
'In this task, you will start out with $5000, and your goal is to 
earn as much money as possible. You will be presented with four 
card decks. When you draw a card from a deck, you will receive 
a monetary reward. The amount of money you earn may differ 
between decks. There is also a chance for a penalty to occur.
This monetary penalty will deduct money. The amount of money 
deducted may differ between deck. You will draw a total of 100 
cards. Earn the most amount of money with those 100 cards.
Click on the Start button to begin."""
  
# Create Canvas
maincanvas = Canvas(window, width = 1296,
                 height = 728, bd=0, highlightthickness=0)
  
maincanvas.pack(fill = "both", expand = True)
  
# Display image
maincanvas.create_image( 0, 0, image = bgimg, 
                     anchor = "nw")
maincanvas.create_text(39,123,anchor="nw",fill="red",font="Times 20 italic bold",
                        text=welcomemsg)
#IGTtext = Text(window,width=75, height=25)

#IGTtext_window = maincanvas.create_window(19, 123, anchor="nw", window=IGTtext)
#IGTtext.pack(side=LEFT)
#IGTtext.insert(0.0, welcomemsg)

deck_list = np.mat([[100, 250],[100,50],[50,50],[50,250]])
np.random.shuffle(deck_list)
global userbest
userbest = 0

global money

initial = 5000 #initial money
money = initial #used later as the running money count
prob = 0.5 #probability of GETTING a deduction (range from 0 to 1)
Aplus = deck_list[0,0]  #when you pick on the card deck, you add this much money
Bplus = deck_list[1,0] 
Cplus = deck_list[2,0] 
Dplus = deck_list[3,0] 
Aminus = deck_list[0,1]  #Penalty amount you get deducted for each deck
Bminus = deck_list[1,1] 
Cminus = deck_list[2,1] 
Dminus = deck_list[3,1] 
Adiff = Aplus - Aminus
Bdiff = Bplus - Bminus
Cdiff = Cplus - Cminus
Ddiff = Dplus - Dminus

global bestdeck
bestdeck = 0

if Adiff>Bdiff and Adiff>Cdiff and Adiff>Ddiff:
    bestdeck=1
elif Bdiff>Cdiff and Bdiff>Ddiff:
    bestdeck =2
elif Cdiff>Ddiff:
    bestdeck=3
else:
    bestdeck=4
###Bonus and penalty for each deck



deck_img = ImageTk.PhotoImage(Image.open("/Users/kushpatel/Documents/GitHub/BinaryBeasts2/deckimg.jpeg"))
img_label = Label(image=deck_img)
#img_label.pack(pady=20)




global count
global countA
global countB
global countC
global countD
countA = 0
countB = 0
countC = 0
countD = 0
count = 1

global starttime 

maxtrials = 9
buttonlist = []
reactiontimes = []
starttime = None
bonAtext = Text(window,width=25, height=5, background="black", foreground="green", font="Times 17")
bonAtext_window = maincanvas.create_window(584, 180, anchor="nw", window=bonAtext)
pentext = Text(window,width=25, height=5, background="black", foreground="red", font="Times 17")
pentext_window = maincanvas.create_window(584, 270, anchor="nw", window=pentext)
#bonAtext.pack(side=LEFT)

def start():
    global starttime
    starttime = time.time() # this is when your program starts
    print(starttime)
    

def functionA(): #function Button A
       buttonlist.append("A")
       global starttime
       print(starttime)
       finaltime = time.time()
       elapsed_time = finaltime - starttime
      
       
       print(elapsed_time)
       reactiontimes.append(elapsed_time)
       starttime = finaltime
       global count
       if count>maxtrials:
            C["state"] = "disabled"
            D["state"] = "disabled"
            A["state"] = "disabled"
            B["state"] = "disabled"
            #results["state"] = "enabled"
       else:
        #results["state"] = "disabled"
        bonAtext.delete(0.0, END)
        pentext.delete(0.0, END)
        if random.uniform(0,1)<=prob: #determines if penalty should occur
              penalty = True 
        else:
            penalty = False

        global money
        
        bonAtext.insert(0.0, "You earned $" + str(Aplus))
        toAdd = Aplus
        money +=toAdd  #adds the money
        scorelabel.config(text = "You currently have $" + str(money))
        if penalty: #if a penalty is to be given
          pentext.insert(0.0, "Your penalty was $" + str(Aminus))
          toSub = Aminus
          money = money - toSub #adds the money
        scorelabel.config(text = "You currently have $" + str(money))
        #labelA = Label(window, text="Button A")
        #labelA.pack()
        global countA
        countA +=1
        count +=1
        countlabel.config(text = "Trial#" + str(count))
       
        
def functionB():
   buttonlist.append("B")
   global starttime
   print(starttime)
   finaltime = time.time()
   elapsed_time = finaltime - starttime

   print(elapsed_time)
   reactiontimes.append(elapsed_time)
   starttime = finaltime
   global count
   if count>maxtrials:
            C["state"] = "disabled"
            D["state"] = "disabled"
            A["state"] = "disabled"
            B["state"] = "disabled"
            #results["state"] = "enabled"
   else:
    #results["state"] = "disabled"
    bonAtext.delete(0.0, END)
    pentext.delete(0.0, END)
    if random.uniform(0,1)<=prob: #determines if penalty should occur
              penalty = True 
    else:
            penalty = False
    global money
    #bonBtext = Text(window,width=75, height=25)
    #bonBtext.pack()
    bonAtext.insert(0.0, "You earned $" + str(Bplus))
    toAdd = Bplus
    money +=toAdd  #adds the money
    scorelabel.config(text = "You currently have $" + str(money))
    if penalty: #if a penalty is to be given
        #penBtext = Text(window,width=75, height=25)
        #penBtext.pack()
        pentext.insert(0.0, "Your penalty was $" + str(Bminus))
        toSub = Bminus
        money = money - toSub #adds the money
        scorelabel.config(text = "You currently have $" + str(money))
    global countB
    countB +=1
    count +=1
    countlabel.config(text = "Trial#" + str(count))
    #labelB = Label(window, text="Button B")
    #labelB.pack()
    
    
def functionC():
   buttonlist.append("C")
   global starttime
   print(starttime)
   finaltime = time.time()
   elapsed_time = finaltime - starttime
       
   print(elapsed_time)
   reactiontimes.append(elapsed_time)
   starttime = finaltime
   global count
   if count>maxtrials:
            C["state"] = "disabled"
            D["state"] = "disabled"
            A["state"] = "disabled"
            B["state"] = "disabled"
            #results["state"] = "enabled"
   else:
    #results["state"] = "disabled"
    bonAtext.delete(0.0, END)
    pentext.delete(0.0, END)
    if random.uniform(0,1)<=prob: #determines if penalty should occur
              penalty = True 
    else:
            penalty = False
    global money
    #bonCtext = Text(window,width=75, height=25)
    #bonCtext.pack()
    bonAtext.insert(0.0, "You earned $" + str(Cplus))
    toAdd = Cplus
    money +=toAdd  #adds the money
    scorelabel.config(text = "You currently have $" + str(money))
    if penalty: #if a penalty is to be given
        #penCtext = Text(window,width=75, height=25)
        #penCtext.pack()
        pentext.insert(0.0, "Your penalty was $" + str(Cminus))
        toSub = Cminus
        money = money - toSub #adds the money
    scorelabel.config(text = "You currently have $" + str(money))
    global countC
    countC +=1
    count +=1
    countlabel.config(text = "Trial#" + str(count))        
    #labelC = Label(window, text="Button C")
    #labelC.pack()
    \



def functionD():
   buttonlist.append("D")
   global starttime
   print(starttime)
   finaltime = time.time()
   elapsed_time = finaltime - starttime
       
   print(elapsed_time)
   reactiontimes.append(elapsed_time)
   starttime = finaltime
   global count
   if count>maxtrials:
            C["state"] = "disabled"
            D["state"] = "disabled"
            A["state"] = "disabled"
            B["state"] = "disabled"
            #results["state"] = "disabled"
   else:
    #results["state"] = "disabled"
    bonAtext.delete(0.0, END)
    pentext.delete(0.0, END)
    
    if random.uniform(0,1)<=prob: #determines if penalty should occur
              penalty = True 
    else:
            penalty = False
    global money
    #bonDtext = Text(window,width=75, height=25)
    #bonDtext.pack()
    bonAtext.insert(0.0, "You earned $" + str(Dplus))
    toAdd = Dplus
    money +=toAdd  #adds the money
    scorelabel.config(text = "You currently have $" + str(money))
    if penalty: #if a penalty is to be given
        #penDtext = Text(window,width=75, height=25)
        #penDtext.pack()
        pentext.insert(0.0, "Your penalty was $" + str(Dminus))
        toSub = Dminus
        money = money - toSub #adds the money
    scorelabel.config(text = "You currently have $" + str(money))
    global countD
    countD += 1
    count +=1
    countlabel.config(text = "Trial#" + str(count))
        
    #labelD = Label(window, text="Button D")
    #labelD.pack()
global graph_window
def functionres():
    A.destroy()
    B.destroy()
    C.destroy()
    D.destroy()
    pentext.destroy()
    bonAtext.destroy()
    countlabel.destroy()
    scorelabel.destroy()
    
    
    
    fig = plt.figure(figsize=(3,3), dpi=100)
    ax = fig.add_subplot(111)
    buttons = ['Deck A', 'Deck B', 'Deck C', 'Deck D']
    bclick = [countA, countB, countC, countD]
    ax.bar(buttons,bclick)
    graph = FigureCanvasTkAgg(fig, window)
    graph_window = maincanvas.create_window(161,443, anchor="nw", window=graph.get_tk_widget())
    
    #graph.get_tk_widget().pack()
    
    
    print(reactiontimes)
    print(buttonlist)
    finaldata = [[buttonlist[i], reactiontimes[i]] for i in range(len(reactiontimes))]
    fig2 = plt.figure(figsize=(3,3), dpi=100)
    rxnbar = fig2.add_subplot(111)
    trials = [1,2,3,4,5,6,7,8,9,10]
    
    rxnbar.bar(trials,reactiontimes)
    graph2 = FigureCanvasTkAgg(fig2, window)
    
    graph2_window = maincanvas.create_window(500,443, anchor="nw", window=graph2.get_tk_widget())
    print(finaldata)
    if userbest==bestdeck:
        textwin = """Congratulations! You picked the best deck! """
        maincanvas.create_text(836,443,anchor="nw",fill="green",font="Times 20 italic bold",
                        text=textwin)
 
        
    else:
        
        textloss = """Oh no! You picked a losing deck – Please try again"""
        maincanvas.create_text(836,443,anchor="nw",fill="red",font="Times 20 italic bold",
                        text=textloss)
     
def functionrestart():
    count = 0
    
def functionquit():
    python = sys.executable
    os.execl(python, python, * sys.argv)
    
if countA>countB and countA>countC and countA>countD:
    userbest=1
elif countB>countC and countB>countD:
    userbest=2
elif countC>countD:
    userbest=3
else:
    userbest=4    
startbutton = Button(window, text="Start", bd=0, highlightthickness=0, command=start)
start_window = maincanvas.create_window(1155, 275, anchor="nw", window=startbutton)
A = Button(maincanvas, image=deck_img,bd=0, highlightthickness=0, command=functionA)
A_window = maincanvas.create_window(161,490, anchor="nw", window=A)


B = Button(maincanvas, image=deck_img, bd=0, highlightthickness=0, command=functionB)
B_window = maincanvas.create_window(411,490, anchor="nw", window=B)
C = Button(maincanvas, image=deck_img, bd=0, highlightthickness=0, command=functionC)
C_window = maincanvas.create_window(661,490, anchor="nw", window=C)
D = Button(maincanvas, image=deck_img, bd=0, highlightthickness=0, command=functionD)
D_window = maincanvas.create_window(911,490, anchor="nw", window=D)
results = Button(window, text="Click to view results", bd=0, highlightthickness=0, command=functionres)
results_window = maincanvas.create_window(1130, 335, anchor="nw", window=results)
quitB = Button(window, text="Quit", bd=0, highlightthickness=0, command=functionquit)
quit_window = maincanvas.create_window(1155, 215, anchor="nw", window=quitB)
restart = Button(window, text="Restart", bd=0, highlightthickness=0, command=functionrestart)
restart_window = maincanvas.create_window(1130, 449, anchor="nw", window=restart)


#A.pack(side = LEFT)
#B.pack(side=LEFT)
#C.pack(side=LEFT)
#D.pack(side=LEFT)
#results.pack(side=TOP)
#startbutton.pack(side=LEFT)
#quitB.pack()



countlabel = Label(window,width=25, height=5, background="black", foreground="white", text="Trial#" + str(count))
countwindow = maincanvas.create_window(584,375, anchor="nw", window=countlabel)

scorelabel = Label(window,width=25, height=5, background="black", foreground="white", text="You currently have $" + str(money))
scorewindow = maincanvas.create_window(584,90, anchor="nw", window=scorelabel)
#scorelabel.pack(side=LEFT)
window.mainloop()